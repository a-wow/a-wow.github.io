/*!
 * Name    : Video Worker (wrapper for Youtube, Vimeo and Local videos)
 * Version : 1.2.0
 * Author  : _nK https://nkdev.info
 * GitHub  : https://github.com/nk-o/jarallax
 */
!function(e){"use strict";function t(){this._done=[],this._fail=[]}function i(e,t,i){e.addEventListener?e.addEventListener(t,i):e.attachEvent("on"+t,(function(){i.call(e)}))}t.prototype={execute:function(e,t){var i=e.length;for(t=Array.prototype.slice.call(t);i--;)e[i].apply(null,t)},resolve:function(){this.execute(this._done,arguments)},reject:function(){this.execute(this._fail,arguments)},done:function(e){this._done.push(e)},fail:function(e){this._fail.push(e)}};var o=function(){var e=0;return function(t,i){var o=this;o.url=t,o.options_default={autoplay:1,loop:1,mute:1,controls:0,startTime:0,endTime:0},o.options=function(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var i in arguments[t])arguments[t].hasOwnProperty(i)&&(e[i]=arguments[t][i]);return e}({},o.options_default,i),o.videoID=o.parseURL(t),o.videoID&&(o.ID=e++,o.loadAPI(),o.init())}}();o.prototype.parseURL=function(e){var t=function(e){var t=e.match(/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);return!(!t||11!==t[1].length)&&t[1]}(e),i=function(e){var t=e.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/);return!(!t||!t[3])&&t[3]}(e),o=function(e){for(var t=e.split(/,(?=mp4\:|webm\:|ogv\:|ogg\:)/),i={},o=0,a=0;a<t.length;a++){var n=t[a].match(/^(mp4|webm|ogv|ogg)\:(.*)/);n&&n[1]&&n[2]&&(i["ogv"===n[1]?"ogg":n[1]]=n[2],o=1)}return!!o&&i}(e);return t?(this.type="youtube",t):i?(this.type="vimeo",i):!!o&&(this.type="local",o)},o.prototype.isValid=function(){return!!this.videoID},o.prototype.on=function(e,t){this.userEventsList=this.userEventsList||[],(this.userEventsList[e]||(this.userEventsList[e]=[])).push(t)},o.prototype.off=function(e,t){if(this.userEventsList&&this.userEventsList[e])if(t)for(var i=0;i<this.userEventsList[e].length;i++)this.userEventsList[e][i]===t&&(this.userEventsList[e][i]=!1);else delete this.userEventsList[e]},o.prototype.fire=function(e){var t=[].slice.call(arguments,1);if(this.userEventsList&&void 0!==this.userEventsList[e])for(var i in this.userEventsList[e])this.userEventsList[e][i]&&this.userEventsList[e][i].apply(this,t)};var a=0;o.prototype.play=function(e){var t=this;t.player&&("youtube"===t.type&&t.player.playVideo&&(void 0!==e&&t.player.seekTo(e||0),t.player.playVideo()),"vimeo"!==t.type||a||(void 0!==e?(a=1,t.player.setCurrentTime(e||0).then((function(){t.player.play(),a=0}))):t.player.play()),"local"===t.type&&(void 0!==e&&(t.player.currentTime=e),t.player.play()))},o.prototype.pause=function(){this.player&&("youtube"===this.type&&this.player.pauseVideo&&this.player.pauseVideo(),"vimeo"===this.type&&this.player.pause(),"local"===this.type&&this.player.pause())},o.prototype.getImageURL=function(e){var t=this;if(t.videoImage)e(t.videoImage);else{if("youtube"===t.type){var i=["maxresdefault","sddefault","hqdefault","0"],o=0,a=new Image;a.onload=function(){120!==(this.naturalWidth||this.width)||o===i.length-1?(t.videoImage="https://img.youtube.com/vi/"+t.videoID+"/"+i[o]+".jpg",e(t.videoImage)):(o++,this.src="https://img.youtube.com/vi/"+t.videoID+"/"+i[o]+".jpg")},a.src="https://img.youtube.com/vi/"+t.videoID+"/"+i[o]+".jpg"}if("vimeo"===t.type){var n=new XMLHttpRequest;n.open("GET","https://vimeo.com/api/v2/video/"+t.videoID+".json",!0),n.onreadystatechange=function(){if(4===this.readyState&&this.status>=200&&this.status<400){var i=JSON.parse(this.responseText);t.videoImage=i[0].thumbnail_large,e(t.videoImage)}},n.send(),n=null}}},o.prototype.getIframe=function(t){var o=this;return o.$iframe?void t(o.$iframe):void o.onAPIready((function(){function a(e,t,i){var o=document.createElement("source");o.src=t,o.type=i,e.appendChild(o)}var n,r;if(o.$iframe||((n=document.createElement("div")).style.display="none"),"youtube"===o.type){var p,s;o.playerOptions={},o.playerOptions.videoId=o.videoID,o.playerOptions.width=e.innerWidth||document.documentElement.clientWidth,o.playerOptions.playerVars={autohide:1,rel:0,autoplay:0},o.options.controls||(o.playerOptions.playerVars.iv_load_policy=3,o.playerOptions.playerVars.modestbranding=1,o.playerOptions.playerVars.controls=0,o.playerOptions.playerVars.showinfo=0,o.playerOptions.playerVars.disablekb=1),o.playerOptions.events={onReady:function(e){o.options.mute&&e.target.mute(),o.options.autoplay&&o.play(o.options.startTime),o.fire("ready",e)},onStateChange:function(e){o.options.loop&&e.data===YT.PlayerState.ENDED&&o.play(o.options.startTime),p||e.data!==YT.PlayerState.PLAYING||(p=1,o.fire("started",e)),e.data===YT.PlayerState.PLAYING&&o.fire("play",e),e.data===YT.PlayerState.PAUSED&&o.fire("pause",e),e.data===YT.PlayerState.ENDED&&o.fire("end",e),o.options.endTime&&(e.data===YT.PlayerState.PLAYING?s=setInterval((function(){o.options.endTime&&o.player.getCurrentTime()>=o.options.endTime&&(o.options.loop?o.play(o.options.startTime):o.pause())}),150):clearInterval(s))}};var l=!o.$iframe;if(l){var d=document.createElement("div");d.setAttribute("id",o.playerID),n.appendChild(d),document.body.appendChild(n)}o.player=o.player||new e.YT.Player(o.playerID,o.playerOptions),l&&(o.$iframe=document.getElementById(o.playerID))}"vimeo"===o.type&&(o.playerOptions="",o.playerOptions+="player_id="+o.playerID,o.playerOptions+="&autopause=0",o.options.controls||(o.playerOptions+="&badge=0&byline=0&portrait=0&title=0"),o.playerOptions+="&autoplay=0",o.playerOptions+="&loop="+(o.options.loop?1:0),o.$iframe||(o.$iframe=document.createElement("iframe"),o.$iframe.setAttribute("id",o.playerID),o.$iframe.setAttribute("src","https://player.vimeo.com/video/"+o.videoID+"?"+o.playerOptions),o.$iframe.setAttribute("frameborder","0"),n.appendChild(o.$iframe),document.body.appendChild(n)),o.player=o.player||new Vimeo.Player(o.$iframe),o.player.setVolume(o.options.mute?0:100),o.options.autoplay&&o.play(o.options.startTime),o.player.on("timeupdate",(function(e){r||o.fire("started",e),r=1,o.options.endTime&&o.options.endTime&&e.seconds>=o.options.endTime&&(o.options.loop?o.play(o.options.startTime):o.pause())})),o.player.on("play",(function(e){o.fire("play",e)})),o.player.on("pause",(function(e){o.fire("pause",e)})),o.player.on("ended",(function(e){o.fire("end",e)})),o.player.on("loaded",(function(e){o.fire("ready",e)})));if("local"===o.type){if(!o.$iframe)for(var u in o.$iframe=document.createElement("video"),o.options.mute&&o.$iframe.setAttribute("mute","on"),o.options.loop&&o.$iframe.setAttribute("loop","on"),o.$iframe.setAttribute("id",o.playerID),n.appendChild(o.$iframe),document.body.appendChild(n),o.videoID)a(o.$iframe,o.videoID[u],"video/"+u);var y;o.player=o.player||o.$iframe,i(o.player,"playing",(function(e){y||o.fire("started",e),y=1})),i(o.player,"timeupdate",(function(){o.options.endTime&&o.options.endTime&&this.currentTime>=o.options.endTime&&(o.options.loop?o.play(o.options.startTime):o.pause())})),i(o.player,"play",(function(e){o.fire("play",e)})),i(o.player,"pause",(function(e){o.fire("pause",e)})),i(o.player,"ended",(function(e){o.fire("end",e)})),i(o.player,"loadedmetadata",(function(){o.fire("ready"),o.options.autoplay&&o.play(o.options.startTime)}))}t(o.$iframe)}))},o.prototype.init=function(){this.playerID="VideoWorker-"+this.ID};var n=0,r=0;o.prototype.loadAPI=function(){if(!n||!r){var t="";if("youtube"!==this.type||n||(n=1,t="//www.youtube.com/iframe_api"),"vimeo"!==this.type||r||(r=1,t="//player.vimeo.com/api/player.js"),t){"file://"===e.location.origin&&(t="http:"+t);var i=document.createElement("script"),o=document.getElementsByTagName("head")[0];i.src=t,o.appendChild(i),o=null,i=null}}};var p=0,s=0,l=new t,d=new t;o.prototype.onAPIready=function(t){var i=this;if("youtube"===i.type&&("undefined"!=typeof YT&&0!==YT.loaded||p?"object"==typeof YT&&1===YT.loaded?t():l.done((function(){t()})):(p=1,e.onYouTubeIframeAPIReady=function(){e.onYouTubeIframeAPIReady=null,l.resolve("done"),t()})),"vimeo"===i.type)if("undefined"!=typeof Vimeo||s)"undefined"!=typeof Vimeo?t():d.done((function(){t()}));else{s=1;var o=setInterval((function(){"undefined"!=typeof Vimeo&&(clearInterval(o),d.resolve("done"),t())}),20)}"local"===i.type&&t()},e.VideoWorker=o}(window),function(){"use strict";if("undefined"!=typeof jarallax){var e=jarallax.constructor,t=e.prototype.init;e.prototype.init=function(){var e=this;t.apply(e),e.video&&e.video.getIframe((function(t){var i=t.parentNode;e.css(t,{position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",visibility:"visible",zIndex:-1}),e.$video=t,e.image.$container.appendChild(t),i.parentNode.removeChild(i)}))};var i=e.prototype.coverImage;e.prototype.coverImage=function(){var e=this;i.apply(e),e.video&&"IFRAME"===e.image.$item.nodeName&&e.css(e.image.$item,{height:e.image.$item.getBoundingClientRect().height+400+"px",top:"-200px"})};var o=e.prototype.initImg;e.prototype.initImg=function(){var e=this;if(e.options.videoSrc||(e.options.videoSrc=e.$item.getAttribute("data-jarallax-video")||!1),e.options.videoSrc){var t=new VideoWorker(e.options.videoSrc,{startTime:e.options.videoStartTime||0,endTime:e.options.videoEndTime||0});if(t.isValid()&&(e.image.useImgTag=!0,t.on("ready",(function(){var i=e.onScroll;e.onScroll=function(){i.apply(e),e.isVisible()?t.play():t.pause()}})),t.on("started",(function(){e.image.$default_item=e.image.$item,e.image.$item=e.$video,e.image.width=e.options.imgWidth=e.image.width||1280,e.image.height=e.options.imgHeight=e.image.height||720,e.coverImage(),e.clipContainer(),e.onScroll(),e.image.$default_item&&(e.image.$default_item.style.display="none")})),e.video=t,"local"!==t.type&&t.getImageURL((function(t){e.image.src=t,e.init()}))),"local"!==t.type)return!1}return o.apply(e)};var a=e.prototype.destroy;e.prototype.destroy=function(){a.apply(this)}}}();